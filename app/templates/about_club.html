{% extends "base.html" %}
{% from "partials/_profile_macros.html" import profile_section, field_row, field_row_pair, field_row_group %}

{% block title %}About Club{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/profile-sections.css') }}">
<style>
    .about-club-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .settings-header {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping */
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .about-club-container h1 {
        width: 100%; /* Take full width */
        color: #004165;
        margin-bottom: 15px; /* Reduced since actions are below */
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .about-club-container h1 i {
        font-size: 0.8em;
        opacity: 0.9;
    }

    /* Club Settings Grid Styles */
    .club-settings-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .club-settings-left {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .settings-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    /* Responsive Mobile View (<= 768px) */
    @media (max-width: 768px) {
        .club-settings-grid {
            grid-template-columns: 1fr;
        }

        .settings-header {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }
    }

    .website-link {
        font-family: 'Montserrat', sans-serif;
        text-decoration: none !important;
        color: #004165;
        font-weight: 600;
    }

    .website-link:hover {
        color: #772432;
    }

    .autocomplete-dropdown {
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        width: calc(100% - 2px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-top: 2px;
    }

    /* Premium Modal Styles */
    .premium-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        z-index: 9999;
        display: none;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .premium-modal-overlay.active {
        opacity: 1;
    }

    .premium-modal {
        background: #fff;
        border-radius: 16px;
        width: 90%;
        max-width: 450px;
        padding: 0;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transform: translateY(20px);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        overflow: hidden;
    }
    
    .premium-modal-overlay.active .premium-modal {
        transform: translateY(0);
    }

    .premium-modal-header {
        background: linear-gradient(135deg, #004165, #006989);
        color: white;
        padding: 20px 25px;
        font-weight: 700;
        font-size: 1.25rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .premium-modal-body {
        padding: 25px;
        color: #333;
        font-family: 'Open Sans', sans-serif;
        line-height: 1.6;
    }

    .premium-modal-footer {
        padding: 15px 25px 25px;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }

    .btn-premium-cancel {
        background-color: #f1f3f5;
        color: #495057;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .btn-premium-cancel:hover {
        background-color: #e9ecef;
    }

    .btn-premium-confirm {
        background: linear-gradient(135deg, #004165, #006989);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        box-shadow: 0 4px 6px rgba(0, 65, 101, 0.2);
        transition: all 0.2s;
    }

    .btn-premium-confirm:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 8px rgba(0, 65, 101, 0.25);
    }
    .btn i {
        margin-right: 8px;
    }
</style>
{% endblock %}

{% block content %}
<div class="about-club-container">
    <div class="settings-header">
        <h1><i class="fas fa-circle-info"></i> About Our Club</h1>
        <div class="header-actions" style="display: flex; align-items: center; gap: 12px;">
            {% if is_authorized(Permissions.ABOUT_CLUB_EDIT) %}
            <div class="button-group">
                <button id="cancel-club-btn" class="btn btn-danger" style="display: none">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button id="edit-club-btn" class="btn btn-primary" style="background-color: #004165; border-color: #004165;">
                    <i class="fas fa-edit"></i> Edit
                </button>
            </div>
            {% endif %}
            
            <!-- Home Club Request Button -->
            {% if current_user.is_authenticated and club %}
                {% set ns = namespace(is_member=false, is_home=false) %}
                {% for m in current_user.club_memberships %}
                    {% if m.club_id == club.id %}
                        {% set ns.is_member = true %}
                        {% if m.is_home %}
                            {% set ns.is_home = true %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
                
                {% if ns.is_member and not ns.is_home %}
                <div class="button-group">
                    <button id="request-home-btn" class="btn btn-outline-primary" style="border-color: #004165; color: #004165; background-color: transparent;" onclick="requestHomeClub({{ club.id }})">
                        <i class="fas fa-home"></i> Set as Home Club
                    </button>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>

    {% if club %}
    <div class="club-settings-grid" id="about-club-content">
        <!-- Left Column: 3 Sections Stacked -->
        <div class="club-settings-left">
            <!-- Basic Information -->
            {% call profile_section("Basic Information") %}
                <div class="field-row">
                    <span class="field-label">Club Logo</span>
                    <div class="field-value">
                        <div id="club-logo-display">
                            {% if club.logo_url %}
                            <img id="current-club-logo" src="{{ url_for('static', filename=club.logo_url) }}" alt="Club Logo" style="max-height: 80px; border-radius: 4px;">
                            {% else %}
                            <span id="no-logo-text" class="text-muted">No logo</span>
                            <img id="current-club-logo" src="" alt="Club Logo" style="max-height: 80px; border-radius: 4px; display: none;">
                            {% endif %}
                        </div>
                        <div id="club-logo-edit" style="display: none; margin-top: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="file" id="logo-upload-input" accept="image/*" class="form-control" style="width: auto; padding: 4px;">
                                <button id="logo-upload-btn" class="btn btn-sm btn-primary" type="button" style="display: none;">Upload</button>
                            </div>
                            <small class="text-muted">Max size 500x500px, WebP/PNG/JPG</small>
                        </div>
                    </div>
                </div>
                {% call field_row_pair(class='mobile-side-by-side') %}
                    {{ field_row("Club Number", value=club.club_no, field_data="club_no", class='compact') }}
                    {{ field_row("Short Name", value=club.short_name, field_data="short_name", class='compact') }}
                {% endcall %}
                {{ field_row("Club Name", value=club.club_name, field_data="club_name") }}
                {{ field_row("Founded Date", value=club.founded_date.strftime('%Y-%m-%d') if club.founded_date else '', field_data="founded_date") }}
                
                {% set website_link %}
                    {% if club.website %}
                    <a href="{{ 'https://' ~ club.website if '://' not in club.website else club.website }}"
                        target="_blank" class="website-link">{{ club.website }}</a>
                    {% endif %}
                {% endset %}
                {{ field_row("Website", value=website_link, is_raw=true, field_data="website") }}
            {% endcall %}

            <!-- Meeting Information -->
            {% call profile_section("Meeting Information") %}
                {% call field_row_pair(class='mobile-side-by-side') %}
                    {{ field_row("Meeting Date", value=club.meeting_date, field_data="meeting_date", class='compact') }}
                    {{ field_row("Meeting Time", value=club.meeting_time.strftime('%H:%M') if club.meeting_time else '', field_data="meeting_time", class='compact') }}
                {% endcall %}
            {% endcall %}

            <!-- Location & Organization -->
            {% call profile_section("Location & Organization") %}
                {% call field_row_group(class='mobile-side-by-side') %}
                    {{ field_row("District", value=club.district, field_data="district", class='compact') }}
                    {{ field_row("Division", value=club.division, field_data="division", class='compact') }}
                    {{ field_row("Area", value=club.area, field_data="area", class='compact') }}
                {% endcall %}
                {{ field_row("Contact Phone", value=club.contact_phone_number, field_data="contact_phone_number") }}
                {{ field_row("Club Address", value=club.club_address, is_textarea=true, field_data="club_address") }}
            {% endcall %}
        </div>

        <!-- Right Column: Executive Committee -->
        <div>
            {% call profile_section("Executive Committee") %}
                {% call field_row_pair(class='mobile-side-by-side') %}
                    {{ field_row("Team Name", value=excomm_team.name, field_data="excomm_name", class='compact') }}
                    {{ field_row("Term", value=excomm_team.term, field_data="excomm_term", class='compact') }}
                {% endcall %}
                
                {% for role, name in excomm_team.members.items() %}
                    {% set role_tag %}<span class="roster-role-tag role-officer" style="margin-bottom: 0;">{{ role }}</span>{% endset %}
                    {{ field_row(role_tag, value=name, is_raw=true, field_data="excomm_" ~ role.lower()) }}
                {% endfor %}
            {% endcall %}
        </div>
    </div>
    {% else %}
    <div class="no-settings-message"
        style="padding: 20px; text-align: center; background-color: #f8f9fa; border-radius: 4px;">
        No club information found.
    </div>
    {% endif %}
</div>

<!-- Premium Custom Modal -->
<div id="premium-confirm-modal" class="premium-modal-overlay">
    <div class="premium-modal">
        <div class="premium-modal-header">
            <span>Set Home Club</span>
            <button class="btn-premium-cancel" style="background:none; color:white; padding:0; font-size:1.5rem;" onclick="closePremiumModal()">&times;</button>
        </div>
        <div class="premium-modal-body">
            <p style="margin-bottom: 15px; font-size: 1.1rem; color: #004165; font-weight: 600;">
                <i class="fas fa-info-circle" style="margin-right: 8px;"></i>Confirm Home Club Selection
            </p>
            <p>Active "Home Club" status determines which club's permissions and defaults apply to you most often.</p>
            <p>Do you want to request to set <strong>{{ club.club_name }}</strong> as your Home Club?</p>
        </div>
        <div class="premium-modal-footer">
            <button class="btn-premium-cancel" onclick="closePremiumModal()">Cancel</button>
            <button id="modal-confirm-btn" class="btn-premium-confirm">Yes, Confirm</button>
        </div>
    </div>
</div>

<script>
    var CONTACTS_DATA = {{ contacts_list | tojson }};

    document.addEventListener('DOMContentLoaded', function () {
        const editBtn = document.getElementById('edit-club-btn');
        const cancelBtn = document.getElementById('cancel-club-btn');
        const aboutContent = document.getElementById('about-club-content');
        let originalValues = {};
        let isEditing = false;

        if (editBtn) {
            editBtn.addEventListener('click', function () {
                if (!isEditing) {
                    enableEditing();
                } else {
                    saveChanges();
                }
            });
        }

        if (cancelBtn) {
            cancelBtn.addEventListener('click', function () { disableEditing(); });
        }

        // Logo Upload Logic
        const logoInput = document.getElementById('logo-upload-input');
        const logoBtn = document.getElementById('logo-upload-btn');
        const currentLogo = document.getElementById('current-club-logo');
        const noLogoText = document.getElementById('no-logo-text');

        if (logoInput) {
            logoInput.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    const file = this.files[0];
                    const maxSize = 5 * 1024 * 1024; // 5MB
                    if (file.size > maxSize) {
                        alert('File is too large. Max size is 5MB.');
                        this.value = ''; // Clear the input
                        logoBtn.style.display = 'none';
                        return;
                    }
                    logoBtn.style.display = 'inline-block';
                } else {
                    logoBtn.style.display = 'none';
                }
            });
        }

        if (logoBtn) {
            logoBtn.addEventListener('click', function() {
                if (!logoInput.files || logoInput.files.length === 0) return;

                const formData = new FormData();
                formData.append('logo', logoInput.files[0]);

                // Disable button and show spinner/text
                const originalText = logoBtn.textContent;
                logoBtn.textContent = 'Uploading...';
                logoBtn.disabled = true;

                fetch('{{ url_for("about_club_bp.upload_club_logo") }}', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        // Update image
                        currentLogo.src = result.logo_url + '?t=' + new Date().getTime(); // force refresh
                        currentLogo.style.display = 'block';
                        if (noLogoText) noLogoText.style.display = 'none';
                        
                        // Reset input
                        logoInput.value = '';
                        logoBtn.style.display = 'none';
                        
                        // Show success message temporarily
                        const successMsg = document.createElement('span');
                        successMsg.textContent = ' Done!';
                        successMsg.style.color = 'green';
                        successMsg.style.marginLeft = '5px';
                        logoBtn.parentNode.appendChild(successMsg);
                        setTimeout(() => successMsg.remove(), 2000);
                    } else {
                        alert('Upload failed: ' + result.message);
                    }
                })
                .catch(err => {
                    console.error('Error uploading logo:', err);
                    alert('Error uploading logo');
                })
                .finally(() => {
                    logoBtn.textContent = originalText;
                    logoBtn.disabled = false;
                });
            });
        }

        function enableEditing() {
            isEditing = true;
            editBtn.innerHTML = '<i class="fas fa-save"></i> Save';
            editBtn.classList.remove('btn-primary');
            editBtn.classList.add('btn-success');
            cancelBtn.style.display = 'inline-block';

            const logoEditDiv = document.getElementById('club-logo-edit');
            if (logoEditDiv) logoEditDiv.style.display = 'block';

            // Target .field-value with data-field attribute
            const cells = document.querySelectorAll('#about-club-content .field-value[data-field]');
            cells.forEach(cell => {
                const field = cell.getAttribute('data-field');
                const value = cell.textContent.trim();
                originalValues[field] = value;

                let input;
                if (field.startsWith('excomm_') && field !== 'excomm_name' && field !== 'excomm_term') {
                    input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'field-input';
                    input.value = value;
                    input.setAttribute('autocomplete', 'off');
                    input.setAttribute('placeholder', 'Search member...');
                    input.setAttribute('data-field', field);

                    const dropdown = document.createElement('div');
                    dropdown.className = 'autocomplete-dropdown';

                    input.addEventListener('input', function (e) {
                        const searchTerm = e.target.value.toLowerCase();
                        dropdown.innerHTML = '';
                        if (searchTerm.length === 0) { dropdown.style.display = 'none'; return; }
                        const filtered = CONTACTS_DATA.filter(contact => contact.name.toLowerCase().includes(searchTerm)).slice(0, 5);
                        if (filtered.length === 0) { dropdown.style.display = 'none'; return; }
                        filtered.forEach(contact => {
                            const item = document.createElement('div');
                            item.textContent = contact.name;
                            item.style.cssText = 'padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #eee;';
                            item.addEventListener('mouseenter', () => item.style.backgroundColor = '#f0f0f0');
                            item.addEventListener('mouseleave', () => item.style.backgroundColor = 'white');
                            item.addEventListener('click', () => { input.value = contact.name; dropdown.style.display = 'none'; });
                            dropdown.appendChild(item);
                        });
                        dropdown.style.display = 'block';
                    });

                    document.addEventListener('click', function (e) {
                        if (!input.contains(e.target) && !dropdown.contains(e.target)) { dropdown.style.display = 'none'; }
                    });

                    cell.style.position = 'relative';
                    cell.textContent = '';
                    
                    // Use a wrapper to match profile structure if possible, but keeping it simple for now
                    const wrapper = document.createElement('div');
                    wrapper.className = 'field-input-wrapper';
                    wrapper.appendChild(input);
                    wrapper.appendChild(dropdown);
                    cell.parentElement.replaceChild(wrapper, cell);
                    wrapper.setAttribute('data-field', field); // Keep data-field for saveChanges
                } else if (field === 'club_address') {
                    input = document.createElement('textarea');
                    input.rows = 3;
                    input.value = value;
                    input.className = 'field-textarea';
                } else if (field === 'meeting_time') {
                    input = document.createElement('input');
                    input.type = 'time';
                    input.className = 'field-input';
                    if (value && value.includes(':')) { input.value = value; }
                } else if (field === 'founded_date') {
                    input = document.createElement('input');
                    input.type = 'date';
                    input.className = 'field-input';
                    if (value) {
                        // Handle both YYYY-MM-DD and MM/DD/YYYY if necessary
                        if (value.includes('-')) {
                            input.value = value;
                        } else {
                            const parts = value.split('/');
                            if (parts.length === 3) {
                                const month = parts[0].padStart(2, '0');
                                const day = parts[1].padStart(2, '0');
                                const year = parts[2];
                                input.value = `${year}-${month}-${day}`;
                            }
                        }
                    }
                } else {
                    input = document.createElement('input');
                    input.type = 'text';
                    input.value = value;
                    input.className = 'field-input';
                }

                if (input && !field.startsWith('excomm_')) {
                    input.setAttribute('data-field', field);
                    const wrapper = document.createElement('div');
                    wrapper.className = 'field-input-wrapper';
                    wrapper.setAttribute('data-field', field);
                    wrapper.appendChild(input);
                    cell.parentElement.replaceChild(wrapper, cell);
                }
            });
        }

        function disableEditing() {
            isEditing = false;
            editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
            editBtn.classList.remove('btn-success');
            editBtn.classList.add('btn-primary');
            editBtn.style.backgroundColor = '#004165';
            cancelBtn.style.display = 'none';

            const logoEditDiv = document.getElementById('club-logo-edit');
            if (logoEditDiv) logoEditDiv.style.display = 'none';

            const wrappers = document.querySelectorAll('#about-club-content .field-input-wrapper[data-field]');
            wrappers.forEach(wrapper => {
                const field = wrapper.getAttribute('data-field');
                const span = document.createElement('span');
                span.className = 'field-value';
                span.setAttribute('data-field', field);
                span.textContent = originalValues[field];
                
                // Special case for website link
                if (field === 'website' && originalValues[field]) {
                    const link = document.createElement('a');
                    let href = originalValues[field];
                    if (!href.includes('://')) href = 'https://' + href;
                    link.href = href;
                    link.target = '_blank';
                    link.className = 'website-link';
                    link.textContent = originalValues[field];
                    span.textContent = '';
                    span.appendChild(link);
                }
                
                wrapper.parentElement.replaceChild(span, wrapper);
            });
            originalValues = {};
        }

        function saveChanges() {
            const inputs = document.querySelectorAll('#about-club-content .field-input, #about-club-content .field-textarea');
            const data = {};
            inputs.forEach(input => {
                const field = input.getAttribute('data-field');
                if (field) {
                    data[field] = input.value;
                }
            });

            fetch('{{ url_for("about_club_bp.about_club_update") }}', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        const wrappers = document.querySelectorAll('#about-club-content .field-input-wrapper[data-field]');
                        wrappers.forEach(wrapper => {
                            const field = wrapper.getAttribute('data-field');
                            const input = wrapper.querySelector('.field-input, .field-textarea');
                            const value = input.value;
                            
                            const span = document.createElement('span');
                            span.className = 'field-value';
                            span.setAttribute('data-field', field);
                            span.textContent = value;

                            // Special case for website link
                            if (field === 'website' && value) {
                                const link = document.createElement('a');
                                let href = value;
                                if (!href.includes('://')) href = 'https://' + href;
                                link.href = href;
                                link.target = '_blank';
                                link.className = 'website-link';
                                link.textContent = value;
                                span.textContent = '';
                                span.appendChild(link);
                            }

                            wrapper.parentElement.replaceChild(span, wrapper);
                        });

                        isEditing = false;
                        editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
                        editBtn.classList.remove('btn-success');
                        editBtn.classList.add('btn-primary');
                        editBtn.style.backgroundColor = '';
                        cancelBtn.style.display = 'none';

                        const logoEditDiv = document.getElementById('club-logo-edit');
                        if (logoEditDiv) logoEditDiv.style.display = 'none';

                        originalValues = {};
                        const originalBg = editBtn.style.backgroundColor;
                        editBtn.style.backgroundColor = '#28a745';
                        setTimeout(() => { editBtn.style.backgroundColor = originalBg; }, 1000);
                    } else { console.error('Error:', result.message); flash(result.message, 'danger'); }
                })
                .catch(error => { console.error('Error:', error); });
        }
    });



    const modalOverlay = document.getElementById('premium-confirm-modal');
    const confirmBtn = document.getElementById('modal-confirm-btn');
    let targetClubId = null;

    function openPremiumModal(clubId) {
        targetClubId = clubId;
        modalOverlay.style.display = 'flex';
        // Trigger reflow for animation
        void modalOverlay.offsetWidth;
        modalOverlay.classList.add('active');
    }

    function closePremiumModal() {
        modalOverlay.classList.remove('active');
        setTimeout(() => {
            modalOverlay.style.display = 'none';
        }, 300); // Wait for transition
    }

    // Attach event listener to confirm button
    if (confirmBtn) {
        confirmBtn.addEventListener('click', function() {
            if (targetClubId) {
                performRequestHomeClub(targetClubId);
                closePremiumModal();
            }
        });
    }

    // Close on outside click
    if (modalOverlay) {
        modalOverlay.addEventListener('click', function(e) {
            if (e.target === modalOverlay) {
                closePremiumModal();
            }
        });
    }

    function requestHomeClub(clubId) {
        openPremiumModal(clubId);
    }
    
    function performRequestHomeClub(clubId) {
        const btn = document.getElementById('request-home-btn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        btn.disabled = true;
        
        fetch(`/clubs/${clubId}/request_home`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success modal or toast (optional, plain alert for now inside success flow)
                // For a premium feel, maybe replace the button text permanently or show a nice toast
                // Using alert for now as per original logic but nicer button state
                btn.innerHTML = '<i class="fas fa-check"></i> Request Sent';
                // Maybe replace with success message in UI instead of alert?
                // Create a temporary toast
                showToast('Request sent successfully to Club Admins!', 'success');
            } else {
                showToast('Error: ' + (data.error || 'Unknown error'), 'error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        })
        .catch(err => {
            showToast('Error sending request.', 'error');
            btn.innerHTML = originalText;
            btn.disabled = false;
        });
    }

    function showToast(message, type) {
        // Simple toast implementation
        const toast = document.createElement('div');
        toast.style.position = 'fixed';
        toast.style.bottom = '20px';
        toast.style.right = '20px';
        toast.style.padding = '12px 24px';
        toast.style.borderRadius = '8px';
        toast.style.color = 'white';
        toast.style.fontWeight = '600';
        toast.style.zIndex = '10000';
        toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        toast.style.transform = 'translateY(100px)';
        toast.style.transition = 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';

        if (type === 'success') {
            toast.style.backgroundColor = '#28a745';
        } else {
            toast.style.backgroundColor = '#dc3545';
        }

        toast.textContent = message;
        document.body.appendChild(toast);

        // Animate in
        setTimeout(() => {
            toast.style.transform = 'translateY(0)';
        }, 10);

        // Remove after 3s
        setTimeout(() => {
            toast.style.transform = 'translateY(100px)';
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }
</script>
{% endblock %}