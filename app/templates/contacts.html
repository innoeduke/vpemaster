{% extends "base.html" %} {% block title %}Contacts{% endblock %} {% block
content %}
<h1>Contacts</h1>

<div class="contact-action-bar">
  <div class="stats-container">
    <div class="stat-item">
      <div class="stat-value" style="color: #007bff">{{ total_contacts }}</div>
      <div class="stat-label">Total Contacts</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" style="color: #28a745">{{ total_members }}</div>
      <div class="stat-label">Total Members</div>
    </div>
  </div>

  <div class="search-and-buttons">
    <div class="search-container">
      <input
        type="text"
        id="searchInput"
        placeholder="Search all columns..."
        class="search-box"
      />
      <button
        id="clear-searchInput"
        class="clear-search-btn"
        style="display: none"
      >
        &times;
      </button>
    </div>
    {% if is_authorized(session.get('user_role'), 'CONTACT_BOOK_EDIT') %}
    <div class="button-group">
      <button class="btn btn-primary" onclick="openContactModal()">
        New Contact
      </button>
      <button
        class="btn btn-info"
        onclick="window.location.href='{{ url_for('roster_bp.roster') }}'"
      >
        Open Roster
      </button>
    </div>
    {% endif %}
  </div>
</div>

<div class="contact-table-container">
  <table id="contactsTable">
    <thead>
      <tr>
        <th class="sortable" data-column-index="0">Name</th>
        <th class="sortable" data-column-index="1">Type</th>
        <th class="sortable" data-column-index="2">Club</th>
        <th class="sortable" data-column-index="3">Participation</th>
        <th class="sortable" data-column-index="4">Credentials</th>
        <th class="sortable" data-column-index="5">Completed Paths</th>
        <th class="sortable" data-column-index="6">Next Project</th>
        {% if is_authorized(session.get('user_role'), 'CONTACT_BOOK_EDIT') %}
        <th class="action-header" data-column-index="7">Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for contact in contacts %}
      <tr>
        <td>
          {{ contact.Name }} {% if contact.DTM %}
          <sup class="dtm-superscript">DTM</sup>
          {% endif %}
        </td>
        <td>{{ contact.Type }}</td>
        <td>{{ contact.Club }}</td>
        <td>
            <div style="display: flex; gap: 5px;">
                <span title="Attendance" style="background-color: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.85em;">
                    <i class="fas fa-calendar-check" style="color: #4a5568;"></i> {{ contact.attendance_count }}
                </span>
                <span title="Roles Taken" style="background-color: #bee3f8; padding: 2px 6px; border-radius: 4px; font-size: 0.85em;">
                     <i class="fas fa-user-tag" style="color: #2b6cb0;"></i> {{ contact.role_count }}
                </span>
                <span title="Awards Won" style="background-color: #feebc8; padding: 2px 6px; border-radius: 4px; font-size: 0.85em;">
                    <i class="fas fa-trophy" style="color: #c05621;"></i> {{ contact.award_count }}
                </span>
            </div>
        </td>
        <td>{% if contact.user %}{{ contact.user.credentials }}{% endif %}</td>
        <td>{{ contact.Completed_Paths }}</td>
        <td>{% if contact.user %}{{ contact.user.Next_Project }}{% endif %}</td>
        {% if is_authorized(session.get('user_role'), 'CONTACT_BOOK_EDIT') %}
        <td>
          <div class="action-links">
            <button
              class="icon-btn"
              onclick="openContactModal({{ contact.id }})"
              title="Edit"
            >
              <i class="fas fa-edit"></i>
            </button>
            
            {% if contact.user %}
            <button class="icon-btn" disabled title="User already exists" style="color: #ccc; cursor: not-allowed;">
                <i class="fas fa-user-plus"></i>
            </button>
            {% else %}
            <form action="{{ url_for('users_bp.quick_add_user', contact_id=contact.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Create user for {{ contact.Name }}?');">
                <button type="submit" class="icon-btn" title="Quick Add User">
                    <i class="fas fa-user-plus"></i>
                </button>
            </form>
            {% endif %}

            <button
              class="delete-btn icon-btn"
              onclick="openDeleteModal('{{ url_for('contacts_bp.delete_contact',contact_id=contact.id) }}', 'contact')"
              title="Delete"
            >
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% include '_contact_modal.html' %}
<script src="{{ url_for('static', filename='js/contacts.js') }}"></script>

{% endblock %}
