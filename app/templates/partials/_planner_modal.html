<!-- Plan Modal -->
<div id="planModal" class="planner-modal">
    <div class="planner-modal-content">
        <span class="planner-close-modal" onclick="closeModal()">&times;</span>
        <div class="planner-modal-header">
            <h3>Plan Detail</h3>
        </div>
        <form id="planForm">
            <input type="hidden" id="plan-id">
            <div class="planner-form-group">
                <label for="meeting_number">Meeting</label>
                <select id="meeting_number" class="planner-form-control" required>
                    <option value="">Select Meeting</option>
                    {% for meeting in meetings %}
                    <option value="{{ meeting.Meeting_Number }}">#{{ meeting.Meeting_Number }} &nbsp; {{ meeting.Meeting_Date.strftime('%b %d, %Y') if meeting.Meeting_Date else 'N/A' }}</option>
                    {% endfor %}
                </select>
                <div id="meeting-date-row" class="meeting-info-row" style="display: none;">
                    <i class="fas fa-calendar-alt"></i>
                    <span id="meeting-date-display"></span>
                </div>
            </div>
            <div class="planner-form-group">
                <label for="meeting_role_id">Meeting Role</label>
                <select id="meeting_role_id" class="planner-form-control" required>
                    <option value="">Select Role</option>
                    <!-- Populated dynamically -->
                </select>
            </div>
            <div id="project-checkbox-group" class="planner-form-group" style="display: none; margin-bottom: 10px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    Project <input type="checkbox" id="has_project_chk">
                </label>
            </div>
            <div id="project-group" class="planner-form-group" style="display: none;">
                <select id="project_id" class="planner-form-control">
                    <option value="">Select Project</option>
                    {% for level, projs in grouped_projects %}
                    <optgroup label="Level {{ level }}">
                        {% for project in projs %}
                        <option value="{{ project.id }}" 
                                data-format="{{ project.Format }}"
                                data-code="{{ project.full_code }}"
                                class="{% if project.is_completed %}project-completed{% endif %}">
                            {% if project.is_completed %}âœ“ {% endif %}{{ project.Project_Name }}
                        </option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                </select>
            </div>
            <div class="planner-form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" class="planner-form-control" rows="3"></textarea>
            </div>
            <div class="planner-modal-footer">
                <button type="button" class="planner-btn planner-btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="button" id="book-btn" class="planner-btn planner-btn-success" style="display: none;" onclick="bookPlan()">Book</button>
                <button type="submit" class="planner-btn planner-btn-primary">Save Draft</button>
            </div>
        </form>
    </div>
</div>
