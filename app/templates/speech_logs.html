{% extends "base.html" %}

{% block title %}
    {% block speech_view_title %}Speech Logs{% endblock %}
{% endblock %}

{% block content %}
<div class="speech-logs-content {% block content_class %}{% endblock %}">
    <h1><i class="fas fa-school"></i> Educational Activities</h1></br>
    
    {% block speech_log_header %}{% endblock %}
    {% block speech_log_toolbar %}{% endblock %}
    {% block speech_log_progress %}{% endblock %}
    
    <div class="speech-log-main-content">
        {% block speech_log_main %}{% endblock %}
    </div>
</div>

{% include '_speech_edit_modal.html' %}

{% block speech_log_modals %}
<!-- Role History Modal (Shared) -->
<div id="roleHistoryModal" class="history-modal">
    <div class="history-modal-content">
        <div class="history-modal-header">
            <h3 id="historyRoleName">Role History</h3>
            <span class="close-history" onclick="closeHistoryModal()">&times;</span>
        </div>
        <div id="historyList" class="history-list">
            <!-- Content will be populated by JS -->
        </div>
    </div>
</div>
{% endblock %}

<script>
    // Pass Python data to global JS variables (Shared Metadata)
    var allProjects = {{ projects| tojson | safe if projects else '[]' }};
    var pathwayMap = {{ pathway_mapping| tojson | safe if pathway_mapping else '{}' }};
    var groupedPathways = {{ pathways| tojson | safe if pathways else '{}' }};
    var ProjectID = {
        GENERIC: {{ ProjectID.GENERIC | tojson | safe if ProjectID else 'null' }},
        TOPICSMASTER_PROJECT: {{ ProjectID.TOPICSMASTER_PROJECT | tojson | safe if ProjectID else 'null' }},
        KEYNOTE_SPEAKER_PROJECT: {{ ProjectID.KEYNOTE_SPEAKER_PROJECT | tojson | safe if ProjectID else 'null' }},
        MODERATOR_PROJECT: {{ ProjectID.MODERATOR_PROJECT | tojson | safe if ProjectID else 'null' }},
        EVALUATION_PROJECTS: {{ ProjectID.EVALUATION_PROJECTS | tojson | safe if ProjectID else 'null' }}
    };
</script>

<script src="{{ url_for('static', filename='js/speech_modal.js') }}"></script>
<script src="{{ url_for('static', filename='js/search.js') }}"></script>
<script src="{{ url_for('static', filename='js/speech_logs.js') }}"></script>

{% block speech_log_scripts %}
<script>
    function toggleLevel(level) {
        const logsContainer = document.getElementById('logs-' + level);
        const progressSummary = document.getElementById('progress-' + level);
        const caret = document.getElementById('caret-' + level);

        const isHidden = !logsContainer || logsContainer.style.display === 'none';

        if (logsContainer) {
            if (isHidden) {
                logsContainer.style.display = 'grid';
                if (progressSummary) progressSummary.style.display = 'flex';
                if (caret) {
                    caret.classList.remove('fa-chevron-right');
                    caret.classList.add('fa-chevron-down');
                }
            } else {
                logsContainer.style.display = 'none';
                if (progressSummary) progressSummary.style.display = 'none';
                if (caret) {
                    caret.classList.remove('fa-chevron-down');
                    caret.classList.add('fa-chevron-right');
                }
            }
        }
    }
</script>
{% endblock %}
{% endblock %}